apiVersion: gateway.networking.k8s.io/v1
kind: Gateway
metadata:
  name: {{ .Values.gateway.name }}
  namespace: {{ .Values.gateway.namespace | default .Release.Namespace }}
spec:
  {{ if .Values.gateway.addresses }}
  addresses:
{{ toYaml .Values.gateway.addresses | indent 4 }}
  {{ end }}

  gatewayClassName: {{ .Values.gateway.gatewayClassName }}
  listeners:
  {{- range .Values.routes }}
    {{- if .httpEnable }}
    - name: {{ .name }}
      protocol: HTTP
      port: 80
      hostname: {{ .hostname | quote }}
      allowedRoutes:
        namespaces:
          from: All
    {{- end }}
    {{- if .tls }}
    - name: {{ .name }}-tls
      protocol: HTTPS
      port: 443
      hostname: {{ .hostname | quote }}
      allowedRoutes:
        namespaces:
          from: All
      tls:
        mode: {{ .tls.mode }}
        certificateRefs:
          - name: {{ .hostname | replace "." "-" }}-tls
    {{- end }}
  {{- end }}